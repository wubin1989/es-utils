{"version":3,"sources":["webpack:///webpack/bootstrap a023b4c491680ff53ef9","webpack:///external \"babel-polyfill\"","webpack:///./EsUtil.js","webpack:///external \"elasticsearch\"","webpack:///external \"lodash\"","webpack:///./dateHistogram.js","webpack:///external \"moment\"","webpack:///./hourHistogram.js","webpack:///./scroll.js","webpack:///./scroll_agg.js","webpack:///./search.js","webpack:///./createIndex.js","webpack:///./getMapping.js","webpack:///./putMapping.js","webpack:///./updateDoc.js","webpack:///./bulkUpdateDocs.js","webpack:///./scrollAndBulkUpdate.js"],"names":["elasticsearch","require","_","EsUtil","config","index","type","client","Client","cloneDeep","fields","pageSize","sortByField","dateField","query","start_date","end_date","_dateHistogram","bind","_hourHistogram","size","sum","wantedField","_scroll","field","_scroll_agg","page_index","aggs","_search","mapping","_createIndex","_getMapping","body","_putMapping","_updateDoc","docs","_bulkUpdateDocs","value","_scrollAndBulkUpdate","module","exports","moment","search","volumn","date_histogram","interval","format","time_zone","min_doc_count","extended_bounds","min","getTime","max","subtract","toDate","obj","i","length","sort","options","scroll","search_type","allValues","that","Promise","resolve","reject","getMoreUntilDone","err","response","hits","forEach","hit","push","Array","isArray","console","log","compare","total","scrollId","_scroll_id","resolved","sortBy","data","EsClient","syntax","JSON","stringify","from","indices","exists","local","then","resp","create","mappings","Error","getMapping","updateAllTypes","putMapping","flatten","map","item","id","doc","update","_index","_type","_id","bulk","_query","count","more","_source","bulkUpdateDocs","bulkUpdateResult","toFixed"],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;ACtCA,4C;;;;;;ACAA;;;;;;AAEA,KAAMA,gBAAgB,mBAAAC,CAAQ,CAAR,CAAtB;AACA,KAAMC,IAAI,mBAAAD,CAAQ,CAAR,CAAV;;KAEME,M;AACL,kBAAYC,MAAZ,EAAoBC,KAApB,EAA2BC,IAA3B,EAAiC;AAAA;;AAChC,QAAKC,MAAL,GAAc,IAAIP,cAAcQ,MAAlB,CAAyBN,EAAEO,SAAF,CAAYL,MAAZ,CAAzB,CAAd;AACA,QAAKC,KAAL,GAAaA,KAAb;AACA,QAAKC,IAAL,GAAYA,IAAZ;AACA;;;;iCAEaI,M,EAAQC,Q,EAAUC,W,EAAaC,S,EAAWC,K,EAAOC,U,EAAYC,Q,EAAU;AACpF,QAAMC,iBAAiB,mBAAAhB,CAAQ,CAAR,EAA2BiB,IAA3B,CAAgC,IAAhC,EAAsCR,MAAtC,EAA8CC,QAA9C,EAAwDC,WAAxD,EAAqEC,SAArE,EAAgFC,KAAhF,EAAuFC,UAAvF,EAAmGC,QAAnG,CAAvB;AACA,WAAOC,gBAAP;AACA;;;iCAEaP,M,EAAQC,Q,EAAUC,W,EAAaC,S,EAAWC,K,EAAOC,U,EAAYC,Q,EAAU;AACpF,QAAMG,iBAAiB,mBAAAlB,CAAQ,CAAR,EAA2BiB,IAA3B,CAAgC,IAAhC,EAAsCR,MAAtC,EAA8CC,QAA9C,EAAwDC,WAAxD,EAAqEC,SAArE,EAAgFC,KAAhF,EAAuFC,UAAvF,EAAmGC,QAAnG,CAAvB;AACA,WAAOG,gBAAP;AACA;;;0BAEMT,M,EAAQU,I,EAAMC,G,EAAKT,W,EAAaE,K,EAAOQ,W,EAAa;AAC1D,QAAMC,UAAU,mBAAAtB,CAAQ,CAAR,EAAoBiB,IAApB,CAAyB,IAAzB,EAA+BR,MAA/B,EAAuCU,IAAvC,EAA6CC,GAA7C,EAAkDT,WAAlD,EAA+DE,KAA/D,EAAsEQ,WAAtE,CAAhB;AACA,WAAOC,SAAP;AACA;;;8BAEUC,K,EAAOJ,I,EAAMC,G,EAAKP,K,EAAO;AACnC,QAAMW,cAAc,mBAAAxB,CAAQ,CAAR,EAAwBiB,IAAxB,CAA6B,IAA7B,EAAmCM,KAAnC,EAA0CJ,IAA1C,EAAgDC,GAAhD,EAAqDP,KAArD,CAApB;AACA,WAAOW,aAAP;AACA;;;0BAEMd,Q,EAAUC,W,EAAaE,K,EAAOY,U,EAAYC,I,EAAM;AACtD,QAAMC,UAAU,mBAAA3B,CAAQ,EAAR,EAAoBiB,IAApB,CAAyB,IAAzB,EAA+BP,QAA/B,EAAyCC,WAAzC,EAAsDE,KAAtD,EAA6DY,UAA7D,EAAyEC,IAAzE,CAAhB;AACA,WAAOC,SAAP;AACA;;;+BAEWC,O,EAAS;AACpB,QAAMC,eAAe,mBAAA7B,CAAQ,EAAR,EAAyBiB,IAAzB,CAA8B,IAA9B,EAAoCW,OAApC,CAArB;AACA,WAAOC,cAAP;AACA;;;gCAEY;AACZ,QAAMC,cAAc,mBAAA9B,CAAQ,EAAR,EAAwBiB,IAAxB,CAA6B,IAA7B,CAApB;AACA,WAAOa,aAAP;AACA;;;8BAEUC,I,EAAM;AAChB,QAAMC,cAAc,mBAAAhC,CAAQ,EAAR,EAAwBiB,IAAxB,CAA6B,IAA7B,EAAmCc,IAAnC,CAApB;AACA,WAAOC,aAAP;AACA;;;6BAESD,I,EAAM;AACf,QAAME,aAAa,mBAAAjC,CAAQ,EAAR,EAAuBiB,IAAvB,CAA4B,IAA5B,EAAkCc,IAAlC,CAAnB;AACA,WAAOE,YAAP;AACA;;;kCAEcC,I,EAAM;AACpB,QAAMC,kBAAkB,mBAAAnC,CAAQ,EAAR,EAA4BiB,IAA5B,CAAiC,IAAjC,EAAuCiB,IAAvC,CAAxB;AACA,WAAOC,iBAAP;AACA;;;uCAEmBZ,K,EAAOJ,I,EAAMiB,K,EAAOvB,K,EAAOO,G,EAAK;AACnD,QAAMiB,uBAAuB,mBAAArC,CAAQ,EAAR,EAAiCiB,IAAjC,CAAsCM,KAAtC,EAA6CJ,IAA7C,EAAmDiB,KAAnD,EAA0DvB,KAA1D,EAAiEO,GAAjE,CAA7B;AACA,WAAOiB,sBAAP;AACA;;;;;;AAGFC,QAAOC,OAAP,GAAiBrC,MAAjB,C;;;;;;ACpEA,2C;;;;;;ACAA,oC;;;;;;ACAA;;AAEA,KAAMsC,SAAS,mBAAAxC,CAAQ,CAAR,CAAf;;AAEAsC,QAAOC,OAAP,GAAiB,UAAS9B,MAAT,EAAiBC,QAAjB,EAA2BC,WAA3B,EAAwCC,SAAxC,EAAmDC,KAAnD,EAA0DC,UAA1D,EAAsEC,QAAtE,EAA+E;AAC5F,SAAG,CAACN,MAAJ,EAAW;AACPA,kBAAS,EAAT;AACH;AACD,YAAO,KAAKH,MAAL,CAAYmC,MAAZ,CAAmB;AAClBrC,gBAAO,KAAKA,KADM;AAElBC,eAAM,KAAKA,IAFO;AAGlB0B,eAAM;AACFlB,oBAAOA,KADL;AAEFa,mBAAM;AACFgB,yBAAQ;AACJC,qCAAgB;AACZpB,gCAAOX,SADK;AAEZgC,mCAAU,KAFE;AAGZC,iCAAQ,UAHI;AAIZC,oCAAW,QAJC;AAKZC,wCAAe,CALH;AAMZC,0CAAiB;AACbC,kCAAKnC,WAAWoC,OAAX,EADQ;AAEbC,kCAAKX,OAAOzB,QAAP,EAAiBqC,QAAjB,CAA0B,CAA1B,EAA6B,MAA7B,EAAqCC,MAArC,GAA8CH,OAA9C;AAFQ;AANL,sBADZ;AAYJxB,2BAAO,UAACjB,MAAD,EAAU;AACb,6BAAI6C,MAAM,EAAV;AACA,8BAAK,IAAIC,IAAE,CAAX,EAAcA,IAAE9C,OAAO+C,MAAvB,EAA8BD,GAA9B,EAAmC;AAC/B,iCAAIhC,QAAQd,OAAO8C,CAAP,CAAZ;AACAD,iCAAI/B,QAAQ,MAAZ,IAAsB;AAClBH,sCAAK;AACDG,4CAAOA;AADN;AADa,8BAAtB;AAKH;AACD,gCAAO+B,GAAP;AACH,sBAXK,CAWH7C,MAXG;AAZF;AADN;AAFJ,UAHY;AAiClBU,eAAMT,QAjCY;AAkClB+C,eAAM9C,cAAc;AAlCF,MAAnB,CAAP;AAoCH,EAxCD,C;;;;;;ACJA,oC;;;;;;ACAA;;AAEA,KAAM6B,SAAS,mBAAAxC,CAAQ,CAAR,CAAf;;AAEAsC,QAAOC,OAAP,GAAiB,UAAS9B,MAAT,EAAiBC,QAAjB,EAA2BC,WAA3B,EAAwCC,SAAxC,EAAmDC,KAAnD,EAA0DC,UAA1D,EAAsEC,QAAtE,EAA+E;AAC5F,SAAG,CAACN,MAAJ,EAAW;AACPA,kBAAS,EAAT;AACH;AACD,YAAO,KAAKH,MAAL,CAAYmC,MAAZ,CAAmB;AAClBrC,gBAAO,KAAKA,KADM;AAElBC,eAAM,KAAKA,IAFO;AAGlB0B,eAAM;AACFlB,oBAAOA,KADL;AAEFa,mBAAM;AACFgB,yBAAQ;AACJC,qCAAgB;AACZpB,gCAAOX,SADK;AAEZgC,mCAAU,MAFE;AAGZC,iCAAQ,eAHI;AAIZ;AACAE,wCAAe,CALH;AAMZC,0CAAiB;AACbC,kCAAKnC,WAAWoC,OAAX,EADQ;AAEbC,kCAAKX,OAAOzB,QAAP,EAAiBqC,QAAjB,CAA0B,CAA1B,EAA6B,OAA7B,EAAsCC,MAAtC,GAA+CH,OAA/C;AAFQ;AANL,sBADZ;AAYJxB,2BAAO,UAACjB,MAAD,EAAU;AACb,6BAAI6C,MAAM,EAAV;AACA,8BAAK,IAAIC,IAAE,CAAX,EAAcA,IAAE9C,OAAO+C,MAAvB,EAA8BD,GAA9B,EAAmC;AAC/B,iCAAIhC,QAAQd,OAAO8C,CAAP,CAAZ;AACAD,iCAAI/B,QAAQ,MAAZ,IAAsB;AAClBH,sCAAK;AACDG,4CAAOA;AADN;AADa,8BAAtB;AAKH;AACD,gCAAO+B,GAAP;AACH,sBAXK,CAWH7C,MAXG;AAZF;AADN;AAFJ,UAHY;AAiClBU,eAAMT,YAAY,CAjCA;AAkClB+C,eAAM,CAAC9C,eAAe,QAAhB,IAA4B;AAlChB,MAAnB,CAAP;AAoCH,EAxCD,C;;;;;;ACJA;;AAEA2B,QAAOC,OAAP,GAAiB,UAAS9B,MAAT,EAAiBU,IAAjB,EAAuBC,GAAvB,EAA4BT,WAA5B,EAAyCE,KAAzC,EAAgDQ,WAAhD,EAA6D;AAC1E,SAAI,CAACD,GAAL,EAAU;AACNA,eAAM,GAAN;AACH;AACD,SAAIsC,UAAU;AACVtD,gBAAO,KAAKA,KADF;AAEVC,eAAM,KAAKA,IAFD;AAGVsD,iBAAQ,KAHE;AAIVxC,eAAMA,QAAQ,EAJJ;AAKVY,eAAMlB,KALI;AAMV+C,sBAAa;AANH,MAAd;;AASA,SAAInD,MAAJ,EAAY;AACRiD,iBAAQjD,MAAR,GAAiBA,MAAjB;AACH;AACD,SAAIE,WAAJ,EAAiB;AACb+C,iBAAQD,IAAR,GAAe9C,cAAc,OAA7B;AACH;AACD,SAAI,CAACU,WAAL,EAAkB;AACdA,uBAAc,QAAd;AACH;;AAED,SAAIwC,YAAY,EAAhB;AACA,SAAMC,OAAO,IAAb;AACA,YAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpCH,cAAKxD,MAAL,CAAYmC,MAAZ,CAAmBiB,OAAnB,EAA4B,SAASQ,gBAAT,CAA0BC,GAA1B,EAA+BC,QAA/B,EAAyC;AACjE,iBAAID,GAAJ,EAAS;AACL,wBAAOF,OAAOE,GAAP,CAAP;AACH;AACDC,sBAASC,IAAT,CAAcA,IAAd,CAAmBC,OAAnB,CAA2B,UAASC,GAAT,EAAc;AACrC,qBAAI,CAAC9D,MAAL,EAAa;AACToD,+BAAUW,IAAV,CAAeD,GAAf;AACH,kBAFD,MAEO;AACH,yBAAI,CAACE,MAAMC,OAAN,CAAcrD,WAAd,CAAL,EAAiC;AAC7B,6BAAIe,QAAQmC,IAAIlD,WAAJ,CAAZ;AACA,6BAAIe,KAAJ,EAAW;AACPyB,uCAAUW,IAAV,CAAepC,KAAf;AACH,0BAFD,MAEO;AACHuC,qCAAQC,GAAR,CAAYxC,KAAZ;AACAuC,qCAAQC,GAAR,CAAYL,GAAZ;AACH;AACJ,sBARD,MAQO;AACH,6BAAInC,SAAQ,EAAZ;AACA,8BAAK,IAAImB,IAAI,CAAb,EAAgBA,IAAIlC,YAAYmC,MAAhC,EAAwCD,GAAxC,EAA6C;AACzCnB,oCAAMf,YAAYkC,CAAZ,CAAN,IAAwBgB,IAAIlD,YAAYkC,CAAZ,CAAJ,KAAuB,EAA/C;AACH;AACDM,mCAAUW,IAAV,CAAepC,MAAf;AACH;AACJ;AACJ,cApBD;;AAsBA,iBAAIyC,UAAUzD,GAAd;AACA,iBAAIgD,SAASC,IAAT,CAAcS,KAAd,GAAsB1D,GAA1B,EAA+B;AAC3ByD,2BAAUT,SAASC,IAAT,CAAcS,KAAxB;AACH;AACD,iBAAIjB,UAAUL,MAAV,GAAmBqB,OAAvB,EAAgC;AAC5B,sBAAKvE,MAAL,CAAYqD,MAAZ,CAAmB;AACfoB,+BAAUX,SAASY,UADJ;AAEfrB,6BAAQ;AAFO,kBAAnB,EAGGO,gBAHH;AAIH,cALD,MAKO;AACH,qBAAIe,WAAWpB,SAAf;AACA,qBAAIlD,WAAJ,EAAiB;AACbsE,gCAAW;AACPC,iCAAQvE,WADD;AAEPwE,+BAAMtB;AAFC,sBAAX;AAIH;AACD,wBAAOG,QAAQiB,QAAR,CAAP;AACH;AACJ,UA7CD;AA8CH,MA/CM,CAAP;AAgDH,EAzED,C;;;;;;ACFA;;AAEA3C,QAAOC,OAAP,GAAiB,UAAShB,KAAT,EAAgBJ,IAAhB,EAAsBC,GAAtB,EAA2BP,KAA3B,EAAiC;AAC1C,SAAI,CAACO,GAAL,EAAU;AACNA,eAAM,GAAN;AACH;AACD,SAAIsC,UAAU;AACVtD,gBAAO,KAAKA,KADF;AAEVC,eAAM,KAAKA,IAFD;AAGVsD,iBAAQ,KAHE;AAIVxC,eAAMA,QAAQ,EAJJ;AAKVY,eAAMlB,KALI;AAMVJ,iBAAQc,KANE;AAOVqC,sBAAa;AAPH,MAAd;;AAUA,SAAIC,YAAY,EAAhB;AACA,SAAMC,OAAO,IAAb;AACA,YAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpCH,cAAKxD,MAAL,CAAYmC,MAAZ,CAAmBiB,OAAnB,EAA4B,SAASQ,gBAAT,CAA0BC,GAA1B,EAA+BC,QAA/B,EAAyC;AACjE,iBAAID,GAAJ,EAAS;AACL,wBAAOF,OAAOE,GAAP,CAAP;AACH;AACDC,sBAASC,IAAT,CAAcA,IAAd,CAAmBC,OAAnB,CAA2B,UAASC,GAAT,EAAc;AACrC,qBAAG,OAAOhD,KAAP,KAAiB,QAApB,EAA6B;AACzBsC,+BAAUW,IAAV,CAAeD,IAAI9D,MAAJ,GAAa8D,IAAI9D,MAAJ,CAAWc,KAAX,EAAkB,CAAlB,CAAb,GAAoC,EAAnD;AACH,kBAFD,MAEK;AACDsC,+BAAUW,IAAV,CAAeD,IAAI9D,MAAJ,GAAa8D,IAAI9D,MAAjB,GAA0B,EAAzC;AACH;AACJ,cAND;;AAQA,iBAAIoE,UAAUzD,GAAd;AACA,iBAAIgD,SAASC,IAAT,CAAcS,KAAd,GAAsB1D,GAA1B,EAA+B;AAC3ByD,2BAAUT,SAASC,IAAT,CAAcS,KAAxB;AACH;AACDH,qBAAQC,GAAR,CAAYC,OAAZ;AACA,iBAAIhB,UAAUL,MAAV,GAAmBqB,OAAvB,EAAgC;AAC5BF,yBAAQC,GAAR,CAAYf,UAAUL,MAAtB;AACA4B,0BAASzB,MAAT,CAAgB;AACZoB,+BAAUX,SAASY,UADP;AAEZrB,6BAAQ;AAFI,kBAAhB,EAGGO,gBAHH;AAIH,cAND,MAMO;AACHS,yBAAQC,GAAR,CAAY,IAAZ;AACA,qBAAIK,WAAWpB,SAAf;AACA,wBAAOG,QAAQiB,QAAR,CAAP;AACH;AACJ,UA5BD;AA6BH,MA9BM,CAAP;AA+BH,EA/CL;AAgDI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G;;;;;;ACtEJ;;AAEA3C,QAAOC,OAAP,GAAiB,UAAS7B,QAAT,EAAmBC,WAAnB,EAAgCE,KAAhC,EAAuCY,UAAvC,EAAmDC,IAAnD,EAAwD;;AAErE,SAAI2D,SAAS;AACTxE,gBAAOA;AADE,MAAb;AAGA,SAAIa,IAAJ,EAAU;AACN2D,gBAAO3D,IAAP,GAAcA,IAAd;AACH;;AAEDiD,aAAQC,GAAR,CAAYU,KAAKC,SAAL,CAAeF,MAAf,EAAuB,IAAvB,EAA6B,CAA7B,CAAZ;AACAV,aAAQC,GAAR,CAAY,iCAAZ;;AAEA,SAAIlB,UAAU;AACVtD,gBAAO,KAAKA,KADF;AAEVC,eAAM,KAAKA,IAFD;AAGV0B,eAAMsD,MAHI;AAIVlE,eAAMT,YAAY,CAJR;AAKV8E,eAAM/D,aAAaA,aAAaf,QAA1B,GAAqC;AALjC,MAAd;;AASA,SAAIC,WAAJ,EAAiB;AACb+C,iBAAQD,IAAR,GAAe9C,cAAc,OAA7B;AACH;;AAED,YAAO,KAAKL,MAAL,CACFmC,MADE,CACKiB,OADL,CAAP;AAEH,EA3BD,C;;;;;;ACFA;;AAEApB,QAAOC,OAAP,GAAiB,UAASX,OAAT,EAAiB;AACjC,SAAO,KAAKtB,MAAL,CAAYmF,OAAZ,CAAoBC,MAApB,CAA2B;AACnBtF,UAAO,KAAKA,KADO;AAEnBuF,UAAO;AAFY,GAA3B,EAILC,IAJK,CAIA,UAACC,IAAD,EAAU;AACf,OAAG,CAACA,IAAJ,EAAS;AACR,WAAOT,SAASK,OAAT,CAAiBK,MAAjB,CAAwB;AAC7B1F,YAAOA,KADsB;AAE7B2B,WAAM;AACJgE,gBAAUnE;AADN;AAFuB,KAAxB,CAAP;AAMA,IAPD,MAOK;AACJ,UAAM,IAAIoE,KAAJ,CAAU,gBAAgB5F,KAAhB,GAAwB,uBAAlC,CAAN;AACA;AACD,GAfK,CAAP;AAgBA,EAjBD,C;;;;;;ACFA;;AAEAkC,QAAOC,OAAP,GAAiB,YAAU;AAC1B,SAAO,KAAKjC,MAAL,CAAYmF,OAAZ,CAAoBQ,UAApB,CAA+B;AACrC7F,UAAO,KAAKA,KADyB;AAErCC,SAAM,KAAKA;AAF0B,GAA/B,CAAP;AAIA,EALD,C;;;;;;ACFA;;AAEAiC,QAAOC,OAAP,GAAiB,UAASR,IAAT,EAAc;;AAE3B,SAAM2B,UAAU;AACZtD,gBAAO,KAAKA,KADA;AAEZC,eAAM,KAAKA,IAFC;AAGZ0B,eAAMA,IAHM;AAIZmE,yBAAgB;AAJJ,MAAhB;;AAOA,YAAO,KAAK5F,MAAL,CAAYmF,OAAZ,CAAoBU,UAApB,CAA+BzC,OAA/B,CAAP;AACH,EAVD,C;;;;;;ACFA;;AAEApB,QAAOC,OAAP,GAAiB,UAASR,IAAT,EAAc;;AAE3B,SAAM2B,UAAU;AACZtD,gBAAO,KAAKA,KADA;AAEZC,eAAM,KAAKA,IAFC;AAGZ0B,eAAMA,IAHM;AAIZmE,yBAAgB;AAJJ,MAAhB;;AAOA,YAAO,KAAK5F,MAAL,CAAYmF,OAAZ,CAAoBU,UAApB,CAA+BzC,OAA/B,CAAP;AACH,EAVD,C;;;;;;ACFA;;;;;;;;;;;;;;;;;;;;AAoBA;;;;AAEApB,QAAOC,OAAP,GAAiB,UAASL,IAAT,EAAe;AAAA;;AAC/B,MAAIA,KAAKsB,MAAT,EAAiB;AAAA;AAChB,QAAMvD,IAAI,mBAAAD,CAAQ,CAAR,CAAV;AACA,QAAM8D,YAAN;AACA,QAAM/B,OAAO9B,EAAEmG,OAAF,CAAUnG,EAAEoG,GAAF,CAAMnE,IAAN,EAAY,UAACoE,IAAD,EAAU;AAC5C,SAAMC,KAAKD,KAAKC,EAAhB;AACA,SAAMC,MAAMF,KAAKE,GAAjB;AACA,YAAO,CAAC;AACPC,cAAQ;AACPC,eAAQ5C,KAAK1D,KADN;AAEPuG,cAAO7C,KAAKzD,IAFL;AAGPuG,YAAKL;AAHE;AADD,MAAD,EAMJ;AACFC,WAAKA;AADH,MANI,CAAP;AASA,KAZsB,CAAV,CAAb;;AAcA;AAAA,QAAO,MAAKlG,MAAL,CAAYuG,IAAZ,CAAiB9E,IAAjB;AAAP;AAjBgB;;AAAA;AAkBhB,GAlBD,MAkBO;AACN,UAAOgC,QAAQC,OAAR,CAAgB,CAAhB,CAAP;AACA;AACD,EAtBD,C;;;;;;ACtBA;;;;;;AAEA1B,QAAOC,OAAP,GAAiB,UAAShB,KAAT,EAAgBJ,IAAhB,EAAsBiB,KAAtB,EAA6BvB,KAA7B,EAAoCO,GAApC,EAAyC;AACtD,SAAMnB,IAAI,mBAAAD,CAAQ,CAAR,CAAV;;AAEA,SAAM8G,SAAS;AACX,kBAAS;AACL,0BAAa;AADR;AADE,MAAf;;AAMA,SAAMpD,UAAU;AACZtD,gBAAO,KAAKA,KADA;AAEZC,eAAM,KAAKA,IAFC;AAGZsD,iBAAQ,KAHI;AAIZxC,eAAMA,QAAQ,IAJF;AAKZY,eAAMlB,SAASiG,MALH;AAMZlD,sBAAa;AAND,MAAhB;;AASA,SAAImD,QAAQ,CAAZ;;AAEA,SAAMjD,OAAO,IAAb;;AAEA,YAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpCH,cAAKxD,MAAL,CAAYmC,MAAZ,CAAmBiB,OAAnB;AAAA,kEAA4B,iBAAgCS,GAAhC,EAAqCC,QAArC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCACpBD,GADoB;AAAA;AAAA;AAAA;;AAAA,kEAEbF,OAAOE,GAAP,CAFa;;AAAA;AAGvB;AACK6C,qCAJkB,GAIX5C,SAASC,IAAT,CAAcA,IAAd,CAAmBb,MAJR;AAKlBsB,sCALkB,GAKVV,SAASC,IAAT,CAAcS,KALJ;AAOlB5C,qCAPkB,GAOXjC,EAAEoG,GAAF,CAAMjC,SAASC,IAAT,CAAcA,IAApB,EAA0B,UAACE,GAAD,EAAS;AAC5C,yCAAMgC,KAAKhC,IAAIqC,GAAf;AACA,yCAAMJ,0BACDjF,KADC,EACOa,SAASmC,IAAI0C,OAAJ,CAAY1F,KAAZ,CADhB,CAAN;AAGA,4CAAO;AACHgF,6CAAIA,EADD;AAEHC,8CAAKA;AAFF,sCAAP;AAIH,kCATY,CAPW;AAAA;AAAA,wCAkBO,KAAKU,cAAL,CAAoBhF,IAApB,CAlBP;;AAAA;AAkBlBiF,iDAlBkB;;;AAqBxBxC,yCAAQC,GAAR,CAAeoC,IAAf,4DAA0E,CAACA,OAAOlC,KAAR,EAAesC,OAAf,CAAuB,CAAvB,CAA1E;;AAEAL,0CAASC,IAAT;;AAEInC,wCAzBoB,GAyBVC,KAzBU;;;AA2BxB,qCAAI1D,OAAOgD,SAASC,IAAT,CAAcS,KAAd,GAAsB1D,GAAjC,EAAsC;AAClCyD,+CAAUzD,GAAV;AACH;;AA7BuB,uCA+BpB2F,QAAQlC,OA/BY;AAAA;AAAA;AAAA;;AAgCpB,sCAAKvE,MAAL,CAAYqD,MAAZ,CAAmB;AACfoB,+CAAUX,SAASY,UADJ;AAEfrB,6CAAQ;AAFO,kCAAnB,EAGGO,gBAHH;AAhCoB;AAAA;;AAAA;AAAA,kEAqCbF,QAAQ,4BAAR,CArCa;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAA5B;;AAAA,sBAA2CE,gBAA3C;AAAA;AAAA;;AAAA,oBAA2CA,gBAA3C;AAAA;AAwCH,MAzCM,CAAP;AA0CH,EAhED,C","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap a023b4c491680ff53ef9","module.exports = require(\"babel-polyfill\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-polyfill\"\n// module id = 1\n// module chunks = 0","'use strict';\n\nconst elasticsearch = require('elasticsearch')\nconst _ = require('lodash')\n\nclass EsUtil {\n\tconstructor(config, index, type) {\n\t\tthis.client = new elasticsearch.Client(_.cloneDeep(config))\n\t\tthis.index = index\n\t\tthis.type = type\n\t}\n\n\tdateHistogram(fields, pageSize, sortByField, dateField, query, start_date, end_date) {\n\t\tconst _dateHistogram = require('./dateHistogram').bind(this, fields, pageSize, sortByField, dateField, query, start_date, end_date)\n\t\treturn _dateHistogram()\n\t}\n\n\thourHistogram(fields, pageSize, sortByField, dateField, query, start_date, end_date) {\n\t\tconst _hourHistogram = require('./hourHistogram').bind(this, fields, pageSize, sortByField, dateField, query, start_date, end_date)\n\t\treturn _hourHistogram()\n\t}\n\n\tscroll(fields, size, sum, sortByField, query, wantedField) {\n\t\tconst _scroll = require('./scroll').bind(this, fields, size, sum, sortByField, query, wantedField)\n\t\treturn _scroll()\n\t}\n\n\tscroll_agg(field, size, sum, query) {\n\t\tconst _scroll_agg = require('./scroll_agg').bind(this, field, size, sum, query)\n\t\treturn _scroll_agg()\n\t}\n\n\tsearch(pageSize, sortByField, query, page_index, aggs) {\n\t\tconst _search = require('./search').bind(this, pageSize, sortByField, query, page_index, aggs)\n\t\treturn _search()\n\t}\n\n\tcreateIndex(mapping) {\n\t\tconst _createIndex = require('./createIndex').bind(this, mapping)\n\t\treturn _createIndex()\n\t}\n\n\tgetMapping() {\n\t\tconst _getMapping = require('./getMapping').bind(this)\n\t\treturn _getMapping()\n\t}\n\n\tputMapping(body) {\n\t\tconst _putMapping = require('./putMapping').bind(this, body)\n\t\treturn _putMapping()\n\t}\n\n\tupdateDoc(body) {\n\t\tconst _updateDoc = require('./updateDoc').bind(this, body)\n\t\treturn _updateDoc()\n\t}\n\n\tbulkUpdateDocs(docs) {\n\t\tconst _bulkUpdateDocs = require('./bulkUpdateDocs').bind(this, docs)\n\t\treturn _bulkUpdateDocs()\n\t}\n\n\tscrollAndBulkUpdate(field, size, value, query, sum) {\n\t\tconst _scrollAndBulkUpdate = require('./scrollAndBulkUpdate').bind(field, size, value, query, sum)\n\t\treturn _scrollAndBulkUpdate()\n\t}\n}\n\nmodule.exports = EsUtil\n\n\n// WEBPACK FOOTER //\n// ./EsUtil.js","module.exports = require(\"elasticsearch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"elasticsearch\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 4\n// module chunks = 0","'use strict';\n\nconst moment = require('moment');\n\nmodule.exports = function(fields, pageSize, sortByField, dateField, query, start_date, end_date){\n    if(!fields){\n        fields = [];\n    }\n    return this.client.search({\n            index: this.index,\n            type: this.type,\n            body: {\n                query: query,\n                aggs: {\n                    volumn: {\n                        date_histogram: {\n                            field: dateField,\n                            interval: 'day',\n                            format: 'yyyy-M-d',\n                            time_zone: '+08:00',\n                            min_doc_count: 0,\n                            extended_bounds: {\n                                min: start_date.getTime(),\n                                max: moment(end_date).subtract(1, 'days').toDate().getTime()\n                            }\n                        },\n                        aggs: ((fields)=>{\n                            let obj = {};\n                            for (let i=0; i<fields.length;i++) {\n                                let field = fields[i];\n                                obj[field + '_sum'] = {\n                                    sum: {\n                                        field: field\n                                    }\n                                }\n                            }\n                            return obj;\n                        })(fields)\n                    }\n                }\n            },\n            size: pageSize,\n            sort: sortByField + ':desc',\n        });\n}\n\n\n// WEBPACK FOOTER //\n// ./dateHistogram.js","module.exports = require(\"moment\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"moment\"\n// module id = 6\n// module chunks = 0","'use strict';\n\nconst moment = require('moment');\n\nmodule.exports = function(fields, pageSize, sortByField, dateField, query, start_date, end_date){\n    if(!fields){\n        fields = [];\n    }\n    return this.client.search({\n            index: this.index,\n            type: this.type,\n            body: {\n                query: query,\n                aggs: {\n                    volumn: {\n                        date_histogram: {\n                            field: dateField,\n                            interval: 'hour',\n                            format: 'yyyy-M-d H:mm',\n                            //time_zone: '+08:00',\n                            min_doc_count: 0,\n                            extended_bounds: {\n                                min: start_date.getTime(),\n                                max: moment(end_date).subtract(1, 'hours').toDate().getTime()\n                            }\n                        },\n                        aggs: ((fields)=>{\n                            let obj = {};\n                            for (let i=0; i<fields.length;i++) {\n                                let field = fields[i];\n                                obj[field + '_sum'] = {\n                                    sum: {\n                                        field: field\n                                    }\n                                }\n                            }\n                            return obj;\n                        })(fields)\n                    }\n                }\n            },\n            size: pageSize || 0,\n            sort: (sortByField || '_score') + ':desc',\n        });\n}\n\n\n// WEBPACK FOOTER //\n// ./hourHistogram.js","'use strict';\n\nmodule.exports = function(fields, size, sum, sortByField, query, wantedField) {\n    if (!sum) {\n        sum = 500;\n    }\n    let options = {\n        index: this.index,\n        type: this.type,\n        scroll: '60s',\n        size: size || 50,\n        body: query,\n        search_type: 'scan',\n    };\n\n    if (fields) {\n        options.fields = fields;\n    }\n    if (sortByField) {\n        options.sort = sortByField + ':desc';\n    }\n    if (!wantedField) {\n        wantedField = 'fields';\n    }\n\n    let allValues = [];\n    const that = this\n    return new Promise((resolve, reject) => {\n        that.client.search(options, function getMoreUntilDone(err, response) {\n            if (err) {\n                return reject(err);\n            };\n            response.hits.hits.forEach(function(hit) {\n                if (!fields) {\n                    allValues.push(hit);\n                } else {\n                    if (!Array.isArray(wantedField)) {\n                        let value = hit[wantedField];\n                        if (value) {\n                            allValues.push(value);\n                        } else {\n                            console.log(value);\n                            console.log(hit);\n                        }\n                    } else {\n                        let value = {};\n                        for (let i = 0; i < wantedField.length; i++) {\n                            value[wantedField[i]] = hit[wantedField[i]] || {};\n                        }\n                        allValues.push(value);\n                    }\n                }\n            });\n\n            let compare = sum;\n            if (response.hits.total < sum) {\n                compare = response.hits.total;\n            }\n            if (allValues.length < compare) {\n                this.client.scroll({\n                    scrollId: response._scroll_id,\n                    scroll: '60s',\n                }, getMoreUntilDone);\n            } else {\n                let resolved = allValues;\n                if (sortByField) {\n                    resolved = {\n                        sortBy: sortByField,\n                        data: allValues,\n                    };\n                }\n                return resolve(resolved);\n            }\n        })\n    });\n}\n\n\n// WEBPACK FOOTER //\n// ./scroll.js","'use strict';\n\nmodule.exports = function(field, size, sum, query){\n        if (!sum) {\n            sum = 500;\n        }\n        let options = {\n            index: this.index,\n            type: this.type,\n            scroll: '60s',\n            size: size || 50,\n            body: query,\n            fields: field,\n            search_type: 'scan',\n        };\n\n        let allValues = [];\n        const that = this\n        return new Promise((resolve, reject) => {\n            that.client.search(options, function getMoreUntilDone(err, response) {\n                if (err) {\n                    return reject(err);\n                };\n                response.hits.hits.forEach(function(hit) {\n                    if(typeof field === 'string'){\n                        allValues.push(hit.fields ? hit.fields[field][0] : '');\n                    }else{\n                        allValues.push(hit.fields ? hit.fields : '');\n                    } \n                });\n\n                let compare = sum;\n                if (response.hits.total < sum) {\n                    compare = response.hits.total;\n                }\n                console.log(compare);\n                if (allValues.length < compare) {\n                    console.log(allValues.length);\n                    EsClient.scroll({\n                        scrollId: response._scroll_id,\n                        scroll: '60s',\n                    }, getMoreUntilDone);\n                } else {\n                    console.log('OK');\n                    let resolved = allValues;\n                    return resolve(resolved);\n                }\n            })\n        });\n    }\n    //\n    //\n    //\n    //\n    //\n    //\n    //\n    //\n    //\n    //\n    //\n    //\n    //\n    //\n    //\n    //\n    //\n    //\n    //\n    //\n    //\n\n\n// WEBPACK FOOTER //\n// ./scroll_agg.js","'use strict';\n\nmodule.exports = function(pageSize, sortByField, query, page_index, aggs){\n\n    let syntax = {\n        query: query,\n    };\n    if (aggs) {\n        syntax.aggs = aggs;\n    }\n\n    console.log(JSON.stringify(syntax, null, 4));\n    console.log('-------------------------------');\n    \n    let options = {\n        index: this.index,\n        type: this.type,\n        body: syntax,\n        size: pageSize || 0,\n        from: page_index ? page_index * pageSize : 0,\n    };\n\n\n    if (sortByField) {\n        options.sort = sortByField + ':desc';\n    }\n\n    return this.client\n        .search(options);\n}\n\n\n// WEBPACK FOOTER //\n// ./search.js","'use strict';\n\nmodule.exports = function(mapping){\n\treturn this.client.indices.exists({\n                index: this.index,\n                local: true\n              })\n\t\t.then((resp) => {\n\t\t\tif(!resp){\n\t\t\t\treturn EsClient.indices.create({\n\t\t\t\t\t\tindex: index,\n\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t  mappings: mapping\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t}else{\n\t\t\t\tthrow new Error('the index: ' + index + 'has already exists!!!')\n\t\t\t}\n\t\t})\n}\n\n\n// WEBPACK FOOTER //\n// ./createIndex.js","'use strict';\n\nmodule.exports = function(){\n\treturn this.client.indices.getMapping({\n\t\tindex: this.index,\n\t\ttype: this.type\n\t})\n}\n\n\n// WEBPACK FOOTER //\n// ./getMapping.js","'use strict';\n\nmodule.exports = function(body){\n    \n    const options = {\n        index: this.index,\n        type: this.type,\n        body: body,\n        updateAllTypes: false,\n    };\n\n    return this.client.indices.putMapping(options)\n}\n\n\n// WEBPACK FOOTER //\n// ./putMapping.js","'use strict';\n\nmodule.exports = function(body){\n    \n    const options = {\n        index: this.index,\n        type: this.type,\n        body: body,\n        updateAllTypes: false,\n    };\n\n    return this.client.indices.putMapping(options)\n}\n\n\n// WEBPACK FOOTER //\n// ./updateDoc.js","/*\nclient.bulk({\n  body: [\n    // action description\n    { index:  { _index: 'myindex', _type: 'mytype', _id: 1 } },\n     // the document to index\n    { title: 'foo' },\n    // action description\n    { update: { _index: 'myindex', _type: 'mytype', _id: 2 } },\n    // the document to update\n    { doc: { title: 'foo' } },\n    // action description\n    { delete: { _index: 'myindex', _type: 'mytype', _id: 3 } },\n    // no document needed for this delete\n  ]\n}, function (err, resp) {\n  // ...\n});\n*/\n\n'use strict'\n\nmodule.exports = function(docs) {\n\tif (docs.length) {\n\t\tconst _ = require('lodash')\n\t\tconst that = this\n\t\tconst body = _.flatten(_.map(docs, (item) => {\n\t\t\tconst id = item.id\n\t\t\tconst doc = item.doc\n\t\t\treturn [{\n\t\t\t\tupdate: {\n\t\t\t\t\t_index: that.index,\n\t\t\t\t\t_type: that.type,\n\t\t\t\t\t_id: id\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tdoc: doc\n\t\t\t}]\n\t\t}))\n\n\t\treturn this.client.bulk(body)\n\t} else {\n\t\treturn Promise.resolve(0)\n\t}\n}\n\n\n// WEBPACK FOOTER //\n// ./bulkUpdateDocs.js","'use strict';\n\nmodule.exports = function(field, size, value, query, sum) {\n    const _ = require('lodash')\n\n    const _query = {\n        \"query\": {\n            \"match_all\": {}\n        }\n    }\n\n    const options = {\n        index: this.index,\n        type: this.type,\n        scroll: '60s',\n        size: size || 1000,\n        body: query || _query,\n        search_type: 'scan',\n    };\n\n    let count = 0\n\n    const that = this\n\n    return new Promise((resolve, reject) => {\n        that.client.search(options, async function getMoreUntilDone(err, response) {\n            if (err) {\n                return reject(err);\n            };\n            const more = response.hits.hits.length\n            const total = response.hits.total\n\n            const docs = _.map(response.hits.hits, (hit) => {\n                const id = hit._id\n                const doc = {\n                    [field]: value || hit._source[field]\n                }\n                return {\n                    id: id,\n                    doc: doc\n                }\n            })\n\n            const bulkUpdateResult = await this.bulkUpdateDocs(docs)\n\n\n            console.log(`${more} has been updated successfully, current progress is ${(more / total).toFixed(3)}%`);\n\n            count += more\n\n            let compare = total;\n\n            if (sum && response.hits.total > sum) {\n                compare = sum\n            }\n\n            if (count < compare) {\n                this.client.scroll({\n                    scrollId: response._scroll_id,\n                    scroll: '60s',\n                }, getMoreUntilDone);\n            } else {\n                return resolve('scroll and update finished');\n            }\n        })\n    });\n}\n\n\n// WEBPACK FOOTER //\n// ./scrollAndBulkUpdate.js"],"sourceRoot":""}